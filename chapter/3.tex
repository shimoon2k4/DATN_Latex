\chapter{Phân tích yêu cầu hệ thống}
\section{Yêu cầu chức năng}
\subsection{Người dùng}
\begin{itemize}
    \item Có thể theo dõi các thông số quan trọng của quá trình vận chuyển theo thời gian thực trên ứng dụng và web, bao gồm độ rung, nhiệt độ, vị trí GPS và thời gian cập nhật.
    \item Có thể xem vị trí hiện tại và toàn bộ lộ trình của phương tiện trên bản đồ, đồng thời cập nhật tuyến đường khi cần thiết.
    \item Có thể nhận cảnh báo ngay lập tức qua ứng dụng hoặc web khi hệ thống phát hiện nhiệt độ hoặc độ rung vượt ngưỡng cho phép hoặc khi phương tiện đi lệch lộ trình.
    \item Có thể giám sát trạng thái vận chuyển và tiến độ của chuyến hàng.
    \item Có thể xem và truy xuất lịch sử của các thông số vận chuyển và các sự kiện cảnh báo đã xảy ra.
    \item Có thể quản lý quyền truy cập và phân quyền cho các vai trò khác nhau như quản trị viên, điều phối viên, lái xe và kỹ thuật viên.
    \item Quản trị viên có thể xem nhật ký đăng nhập và thao tác của tất cả người dùng trong hệ thống.
\end{itemize}

\subsection{Hệ thống}
\begin{itemize}
    \item Phải liên tục thu thập và xử lý dữ liệu từ các cảm biến độ rung, nhiệt độ và thiết bị GPS.
    \item Phải đồng bộ hóa các dữ liệu này lên hệ thống trung tâm và hiển thị theo thời gian thực trên giao diện người dùng.
    \item Phải phân tích dữ liệu để đề xuất lộ trình tối ưu dựa trên các thông số đã thu được.
    \item Phải tự động xác định và kích hoạt cảnh báo khi các thông số vượt ngưỡng hoặc khi vị trí phương tiện đi chệch khỏi lộ trình đã định.
    \item Phải gửi thông báo cảnh báo đến trung tâm điều hành và người có thẩm quyền qua ứng dụng hoặc web.
    \item Phải lưu trữ và quản lý toàn bộ lịch sử vận chuyển và dữ liệu liên quan một cách an toàn.
    \item Phải thực hiện xác thực người dùng trước khi cấp quyền truy cập hệ thống.
    \item Phải thực hiện xác thực thiết bị trước khi chấp nhận dữ liệu gửi về.
    \item Phải mã hóa dữ liệu trong quá trình truyền tải và khi lưu trữ để đảm bảo bảo mật dữ liệu.
\end{itemize}
\section{Yêu cầu phi chức năng}
\subsection{Hiệu năng}
\begin{itemize}
    \item Hệ thống phải đảm bảo truyền dữ liệu từ thiết bị đến máy chủ trong khoảng 2-3 giây.
    \item Dữ liệu mới phải được cập nhật lên giao diện người dùng trong vòng dưới 5 giây kể từ khi dữ liệu được gửi về.
\end{itemize}

\subsection{Tính sẵn sàng}
\begin{itemize}
    \item Hệ thống phải đảm bảo sẵn sàng hoạt động trên 90\% khi có kết nối mạng ổn định.
    \item Dữ liệu phải được thu thập và lưu trữ liên tục khi hệ thống hoạt động.
\end{itemize}

\subsection{Khả năng mở rộng}
\begin{itemize}
    \item Hệ thống phải hỗ trợ cùng lúc nhiều thiết bị, với mức tối thiểu là 4 thiết bị đang hoạt động đồng thời.
    \item Thiết kế hệ thống phải cho phép tích hợp thêm các loại cảm biến mới khác nếu có nhu cầu giám sát mở rộng.
\end{itemize}

\subsection{Tính dễ sử dụng}
\begin{itemize}
    \item Giao diện người dùng phải trực quan, dễ nhìn và dễ thao tác.
    \item Người dùng mới có thể làm quen với các chức năng chính của hệ thống trong không quá 15 phút.
\end{itemize}

\subsection{Tính tương thích}
\begin{itemize}
    \item Hệ thống phải tương thích với các thiết bị IoT phổ biến trên thị trường.
    \item Ứng dụng di động phải hỗ trợ tốt trên nền tảng Android.
\end{itemize}

\subsection{Khả năng bảo trì}
\begin{itemize}
    \item Hệ thống phải được thiết kế theo hướng module hóa để cho phép bảo trì hoặc nâng cấp từng phần mà không làm ảnh hưởng đến toàn bộ hoạt động.
    \item Phải cung cấp đầy đủ tài liệu kỹ thuật và hướng dẫn sử dụng.
\end{itemize}
\section{Quy trình vận chuyển đạn dược}

\section{Các rủi ro cần giám sát}

\section{Use-case diagram}
\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\linewidth]{images/chapter_3/usecase.png}
    \caption{Usecase diagram}
    \label{fig:placeholder}
\end{figure}
\textbf{Đặc tả diagram}

\section{Activity diagram}
\subsection{Điều phối lộ trình}
Sơ đồ hoạt động này minh hoạ các khối chức năng của hệ thống, bao gồm ba phần: \textbf{Người dùng (Điều phối viên)}, \textbf{Hệ thống điều phối}, và \textbf{Thiết bị/Phương tiện}.

\textbf{Người dùng}
\begin{itemize}
  \item Khởi tạo yêu cầu điều phối và nhập ràng buộc: điểm nhận/giao, cửa sổ thời gian, năng lực phương tiện, vùng cấm (geofence), yêu cầu an toàn.
  \item Duyệt phương án hệ thống đề xuất (KPI/ETA hiển thị trên bản đồ) và phê duyệt (Approve) hoặc quay lại chỉnh ràng buộc nếu chưa phù hợp.
\end{itemize}

\textbf{Hệ thống điều phối}
\begin{itemize}
  \item Kiểm tra hợp lệ dữ liệu đầu vào (đủ trường, không trùng, đúng geofence \& time window).
  \item Xây dựng đồ thị lộ trình và chạy thuật toán tối ưu (VRP/TSP mở rộng) để tạo kế hoạch lộ trình kèm KPI/ETA.
  \item Đóng gói payload (các chặng, toạ độ, ETA, geofence, tham số cảnh báo) và phát hành qua broker.
  \item Theo dõi ACK từ thiết bị; nếu không nhận ACK thì xếp hàng/Retry theo backoff cho lần gửi tiếp theo.
\end{itemize}

\textbf{Thiết bị/Phương tiện}
\begin{itemize}
  \item Nhận lộ trình, gửi ACK xác nhận và bắt đầu hành trình theo kế hoạch đã phát hành.
\end{itemize}

\textbf{Kết quả:} Kế hoạch lộ trình được tối ưu, phê duyệt và phát hành xuống thiết bị; trạng thái phát hành được theo dõi qua ACK/Retry để đảm bảo thực thi.

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{images/week/week_3/activity_điều phối.png}
  \caption{Activity diagram: Điều phối lộ trình}
  \label{fig:act-dieu-phoi}
\end{figure}

% -------------------------------------------------------------

\subsection{Quản lý hàng hoá}
Sơ đồ hoạt động này minh hoạ vòng đời bản ghi hàng hoá/đơn vận chuyển: đăng ký, cập nhật, bàn giao và theo dõi trạng thái. Quá trình gồm Người dùng (Kho/Điều phối), Hệ thống quản lý và Điểm giao nhận/Thiết bị quét.

\textbf{Người dùng}
\begin{itemize}
  \item \textbf{Đăng ký (Add):} nhập thông tin lô/đơn (loại, khối lượng, bao gói, đơn vị nhận, ưu tiên).
  \item \textbf{Cập nhật (Update):} quét/nhập \texttt{ID} để chỉnh thuộc tính.
  \item \textbf{Tra cứu \& đổi trạng thái (Track):} theo tiến trình \texttt{READY} $\rightarrow$ \texttt{LOADED} $\rightarrow$ \texttt{IN\_TRANSIT} $\rightarrow$ \texttt{DELIVERED/RETURNED}.
  \item Tại các điểm Load/Unload/Deliver: quét ID để ghi nhận bàn giao.
\end{itemize}

\textbf{Hệ thống quản lý}
\begin{itemize}
  \item Xác thực dữ liệu khi tạo mới; nếu trùng ID trả lỗi và yêu cầu nhập lại; nếu hợp lệ thì cấp/ghi ID (QR/RFID) và lưu CSDL.
  \item Với Update/Track: kiểm tra tồn tại; nếu có, cho phép chỉnh sửa/đổi trạng thái và ghi audit log.
  \item Với sự kiện bàn giao: đối chiếu đơn--phương tiện, ghi sự kiện (thời gian, vị trí, người phụ trách) và đồng bộ trạng thái lên dashboard/app.
\end{itemize}

\textbf{Điểm giao nhận/Thiết bị quét}
\begin{itemize}
  \item Quét \& gửi đối soát (OK/Rejected). Trường hợp không khớp, hệ thống từ chối và yêu cầu kiểm tra lại trước khi cập nhật.
\end{itemize}

\textbf{Kết quả:} Hàng hoá được đăng ký -- truy vết -- bàn giao đúng quy trình; audit log đầy đủ; trạng thái đồng bộ giữa kho, phương tiện và dashboard.

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{images/week/week_3/activity_quản lý.png}
  \caption{Activity diagram: Quản lý hàng hoá}
  \label{fig:act-hang-hoa}
\end{figure}

% -------------------------------------------------------------

\subsection{Giám sát \& cập nhật trạng thái vận chuyển }
Sơ đồ hoạt động này minh hoạ pipeline thu thập -- xác thực -- lưu trữ telemetry (GPS, tốc độ, nhiệt, rung), phát hiện bất thường và cập nhật trạng thái chuyến. Quá trình gồm \textbf{Thiết bị}, \textbf{Hệ thống giám sát} và \textbf{Người dùng (Giám sát viên/Điều phối)}.

\textbf{Thiết bị}
\begin{itemize}
  \item Định kỳ gửi gói dữ liệu. Nếu Online gửi trực tiếp; nếu Offline thì đệm cục bộ và gửi lại khi có kết nối.
\end{itemize}

\textbf{Hệ thống giám sát}
\begin{itemize}
  \item Nhận gói tin và xác thực (verify): định danh, bảo mật/chữ ký, cấu trúc dữ liệu.
  \item Nếu không đạt, ghi lỗi và không cập nhật; nếu đạt, lưu dữ liệu và cập nhật trạng thái chuyến (\texttt{IN\_TRANSIT}/\texttt{DELAYED}/\texttt{ALERT}/\texttt{ARRIVED}/\texttt{DELIVERED}).
  \item Đánh giá luật bất thường: vượt ngưỡng an toàn (nhiệt/rung), lệch lộ trình (geofence), dừng bất thường/over-speed. Khi phát hiện ALERT, tạo cảnh báo, có thể mở sự cố và đề xuất hành động; nếu đến đích, xác nhận bàn giao và đóng chuyến.
\end{itemize}

\textbf{Người dùng}
\begin{itemize}
  \item Nhận thông báo, xử lý cảnh báo (ack/assign/resolve), và khi cần có thể bổ sung ghi chú để hoàn tất hồ sơ sự cố.
\end{itemize}

\textbf{Kết quả:} Trạng thái vận chuyển được cập nhật liên tục; bất thường được phát hiện sớm \& cảnh báo; dữ liệu được xác thực -- lưu trữ an toàn và liên thông với điều phối để tái tối ưu khi cần.

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{images/week/week_3/activity_giám sát.png}
  \caption{Activity diagram: Giám sát \& cập nhật trạng thái vận chuyển}
  \label{fig:act-giam-sat}
\end{figure}

